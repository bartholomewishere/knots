<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trefoil Knot</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
        }
        input[type="range"] {
            width: 200px;
        }
        .value {
            display: inline-block;
            margin-left: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="controls">
        <h3 style="margin-top: 0;">Trefoil Knot</h3>
        <label>Tube Radius: <span class="value" id="radiusValue">0.40</span></label>
        <input type="range" id="radius" min="0.1" max="0.8" step="0.05" value="0.4">
        
        <label>Segments: <span class="value" id="segmentsValue">200</span></label>
        <input type="range" id="segments" min="50" max="400" step="50" value="200">
        
        <label>Color</label>
        <input type="color" id="color" value="#808080">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, trefoilMesh;
        
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 8);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(5, 5, 5);
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-5, -5, -5);
            scene.add(directionalLight2);
            
            // Create trefoil
            createTrefoil();
            
            // Controls
            setupControls();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            // Animation
            animate();
        }
        
        function trefoilParametric(t) {
            const x = Math.sin(t) + 2 * Math.sin(2 * t);
            const y = Math.cos(t) - 2 * Math.cos(2 * t);
            const z = -Math.sin(3 * t);
            return new THREE.Vector3(x, y, z);
        }
        
        function createTrefoil() {
            const segments = parseInt(document.getElementById('segments').value);
            const radius = parseFloat(document.getElementById('radius').value);
            const color = document.getElementById('color').value;
            
            // Create curve
            const points = [];
            for (let i = 0; i <= segments; i++) {
                const t = (i / segments) * Math.PI * 2;
                points.push(trefoilParametric(t));
            }
            
            const curve = new THREE.CatmullRomCurve3(points);
            curve.closed = true;
            
            // Create tube geometry
            const tubeGeometry = new THREE.TubeGeometry(curve, segments, radius, 32, true);
            const material = new THREE.MeshStandardMaterial({
                color: color,
                roughness: 0.4,
                metalness: 0.3,
                flatShading: false
            });
            
            // Remove old mesh if exists
            if (trefoilMesh) {
                scene.remove(trefoilMesh);
                trefoilMesh.geometry.dispose();
                trefoilMesh.material.dispose();
            }
            
            trefoilMesh = new THREE.Mesh(tubeGeometry, material);
            scene.add(trefoilMesh);
        }
        
        function setupControls() {
            const radiusSlider = document.getElementById('radius');
            const segmentsSlider = document.getElementById('segments');
            const colorPicker = document.getElementById('color');
            
            radiusSlider.addEventListener('input', (e) => {
                document.getElementById('radiusValue').textContent = e.target.value;
                createTrefoil();
            });
            
            segmentsSlider.addEventListener('input', (e) => {
                document.getElementById('segmentsValue').textContent = e.target.value;
                createTrefoil();
            });
            
            colorPicker.addEventListener('input', () => {
                createTrefoil();
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate the trefoil
            if (trefoilMesh) {
                trefoilMesh.rotation.x += 0.003;
                trefoilMesh.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        init();
    </script>
</body>
</html>